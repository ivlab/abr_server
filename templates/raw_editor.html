{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raw State Editor</title>
</head>
<body>
    <div style="display: inline;">
        <textarea rows="50" cols="80" id="editor"></textarea>
        <button id="update" style="vertical-align: top;" onclick="updateState()">Update state</button>
        <button id="undo" style="vertical-align: top;" onclick="undo()">Undo</button>
        <button id="redo" style="vertical-align: top;" onclick="redo()">Redo</button>
    </div>

    <script src="{% static 'common/csrf.js' %}"></script>

    <script>
        let editor = document.getElementById('editor');
        fetch('/api/state').then((resp) => resp.text())
            .then((state) => {
                let t = JSON.parse(state)['state'];
                editor.value = JSON.stringify(t, null, 5);
        });
        function updateState() {
            document.getElementById('update').disabled = true;
            fetch('/api/state', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                mode: 'same-origin',
                body: editor.value,
            }).then((resp) => {
                if (resp.status != 200) {
                    alert(resp.statusText);
                }
                document.getElementById('update').disabled = false;
            });
        }
        function undo() {
            document.getElementById('undo').disabled = true;
            fetch('/api/undo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                mode: 'same-origin',
            }).then((resp) => {
                if (resp.status != 200) {
                    alert(resp.statusText);
                }
                document.getElementById('undo').disabled = false;
            });
        }
        function redo() {
            document.getElementById('redo').disabled = true;
            fetch('/api/redo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                mode: 'same-origin',
            }).then((resp) => {
                if (resp.status != 200) {
                    alert(resp.statusText);
                }
                document.getElementById('redo').disabled = false;
            });
        }
    </script>
</body>
</html>