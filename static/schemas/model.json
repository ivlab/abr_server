{
    "$schema": "https://www.sculpting-vis.org/abr-schemas/",
    "$id": "https://www.sculpting-vis.org/abr-schemas/model.json",
    "title": "ABR Model",
    "description": "The canonical model for Artifact-Based Rendering operations - the 'state' which is changeable by the user",
    "type": "object",

    "required": ["version", "spec"],


    "properties": {
        "version": {
            "type": "string",
            "description": "Version of the model (semantic version, update this when updating the model)",
            "const": "0.0.0"
        },

        "spec": {
            "type": "string",
            "description": "Version of the spec (sematic version)"
        },

        "impressions": {
            "type": "array",
            "items": {"$ref": "#/definitions/Impression"},
            "description": "The data impressions that a user has created"
        },

        "scene": {
            "type": "object",
            "description": "Any additional info about the scene (lights, camera, transforms, etc.)",
            "patternProperties": {
                ".+": {}
            }
        },

        "uiData": {
            "type": "object",
            "description": "Any additional info about user interfaces (artist UI, legend UI, physician UI, ...)",
            "patternProperties": {
                ".+": {}
            }
        },

        "localVisAssets": {
            "type": "array",
            "description": "VisAssets that are specific to this state",
            "items": {"$ref": "#/definitions/LocalVisAsset"}
        },

        "gradients": {
            "type": "array",
            "description": "Gradients of VisAssets that are stored in the state",
            "items": {"$ref": "#/definitions/Gradient"}
        }
    },


    "definitions": {
        "Impression": {
            "type": "object",
            "description": "A single data impression (ABR layer)",
            "required": ["uuid"],
            "properties": {
                "uuid": {
                    "$ref": "#/definitions/UUID",
                    "description": "The unique identifier for this data impression"
                },
                "name": {
                    "type": "string",
                    "description": "User-defined name of the data impression (i.e. 'blue ocean')",
                    "default": "Data Impression"
                },
                "visible": {
                    "type": "boolean",
                    "description": "Is the layer visible in the rendering engine?",
                    "default": true
                },
                "inputValues": {
                    "type": "array",
                    "items": {"$ref": "#/definitions/InputValue"},
                    "description": "Input values for this data impression (i.e. Key Data, Colormap, Color Variable, etc.)"
                }
            }
        },

        "InputValue": {
            "type": "object",
            "description": "A single input value for a data impression",
            "required": ["inputName", "inputValue"],
            "properties": {
                "inputType": {
                    "type": "string",
                    "description": "The type of this input (corresponds to a type in the ABR spec)"
                },
                "inputName": {
                    "type": "string",
                    "description": "Name of the input"
                },
                "inputValue": {
                    "type": "string",
                    "description": "UUID or resolvable path where the input can be found",
                    "oneOf": [
                        {"$ref": "#/definitions/UUID"},
                        {"$ref": "#/definitions/Path"}
                    ]
                }
            }
        },

        "LocalVisAsset": {
            "type": "object",
            "description": "A vis asset stored locally in this state (one that has been modified by the user in ABR)",
            "required": ["uuid"],
            "properties": {
                "uuid": {
                    "$ref": "#/definitions/UUID",
                    "description": "The UUID of the local vis asset"
                },
                "files": {
                    "type": "array",
                    "description": "Files that are included with this VisAsset (should be small, e.g. colormap.xml)",
                    "items": "string"
                },
                "fileContents": {
                    "type": "array",
                    "description": "Contents of any files that are stored in this LocalVisAsset"
                }
            }
        },

        "Gradient": {
            "type": "object",
            "description": "A gradient of VisAssets",
            "properties": {
                "gradientScale": {
                    "type": "string",
                    "description": "Is it a continuous or discrete gradient?",
                    "enum": ["continuous", "discrete"]
                },
                "gradientType": {
                    "$ref": "#/defininitions/VisAssetType",
                    "description": "What are the elements of this gradient? (colormap, glyphs, ...)"
                },
                "points": {
                    "type": "array",
                    "description": "The floating point 'stops' in the gradient. Must be the same length as `visAssets`",
                    "items": "number"
                },
                "visAssets": {
                    "type": "array",
                    "description": "The UUIDs of the VisAssets in the gradient. Must be the same length as `points`",
                    "items": {"$ref": "#/definitions/UUID"}
                }
            }
        },

        "VisAssetType": {
            "type": "string",
            "enum": ["colormap", "glyph", "line", "texture"]
        },

        "UUID": {
            "type": "string",
            "pattern": "^([a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}){1}$"
        },

        "Path": {
            "type": "string",
            "pattern": "^(/[^/]+)+$"
        }
    }
}